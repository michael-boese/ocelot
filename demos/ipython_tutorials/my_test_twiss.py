# this python library provides generic shallow (copy) and
# deep copy (deepcopy) operations
from copy import deepcopy

import matplotlib.pyplot as plt
import time

# import from Ocelot main modules and functions
from ocelot import *

# import from Ocelot graphical modules
from ocelot.gui.accelerator import *

# import injector lattice
from injector_lattice import *


def test_twiss_length(tws):
    ground_truth = [(0.0, 'None'), (0.0, 'Marker'), (0.0, 'Marker'), (0.0, 'Marker'), (0.276, 'Drift'), (0.276, 'Solenoid'), (0.75, 'Drift'), (0.775, 'Hcor'), (0.8, 'Vcor'), (1.05, 'Drift'), (1.05, 'Monitor'), (1.2, 'Drift'), (1.2, 'Monitor'), (1.2, 'Monitor'), (1.398782, 'Drift'), (1.398782, 'Marker'), (1.398782, 'Marker'), (1.728, 'Drift'), (1.753, 'Hcor'), (1.7779999999999998, 'Vcor'), (1.8379999999999999, 'Drift'), (1.8379999999999999, 'Monitor'), (2.0629999999999997, 'Drift'), (2.0629999999999997, 'Monitor'), (2.0629999999999997, 'Monitor'), (2.151, 'Drift'), (2.151, 'Monitor'), (2.262, 'Drift'), (2.262, 'Monitor'), (2.312, 'Drift'), (2.3369999999999997, 'Hcor'), (2.3619999999999997, 'Vcor'), (2.7483999999999997, 'Drift'), (2.7483999999999997, 'Marker'), (3.1999999999999997, 'Drift'), (3.1999999999999997, 'Marker'), (3.2996, 'Drift'), (3.2996, 'Marker'), (3.5212, 'Drift'), (3.5212, 'CouplerKick'), (4.5588999999999995, 'Cavity'), (4.5588999999999995, 'CouplerKick'), (4.9048, 'Drift'), (4.9048, 'CouplerKick'), (5.9425, 'Cavity'), (5.9425, 'CouplerKick'), (6.2884, 'Drift'), (6.2884, 'CouplerKick'), (7.3261, 'Cavity'), (7.3261, 'CouplerKick'), (7.672000000000001, 'Drift'), (7.672000000000001, 'CouplerKick'), (8.709700000000002, 'Cavity'), (8.709700000000002, 'CouplerKick'), (9.055600000000002, 'Drift'), (9.055600000000002, 'CouplerKick'), (10.093300000000003, 'Cavity'), (10.093300000000003, 'CouplerKick'), (10.439200000000003, 'Drift'), (10.439200000000003, 'CouplerKick'), (11.476900000000004, 'Cavity'), (11.476900000000004, 'CouplerKick'), (11.822800000000004, 'Drift'), (11.822800000000004, 'CouplerKick'), (12.860500000000005, 'Cavity'), (12.860500000000005, 'CouplerKick'), (13.206400000000006, 'Drift'), (13.206400000000006, 'CouplerKick'), (14.244100000000007, 'Cavity'), (14.244100000000007, 'CouplerKick'), (14.448400000000007, 'Drift'), (14.448400000000007, 'Marker'), (14.748400000000007, 'Quadrupole'), (14.748400000000007, 'Hcor'), (14.748400000000007, 'Vcor'), (14.833400000000008, 'Drift'), (14.833400000000008, 'Monitor'), (15.291300000000009, 'Drift'), (15.291300000000009, 'Marker'), (15.291300000000009, 'Marker'), (15.512400000000008, 'Drift'), (15.512400000000008, 'Monitor'), (15.59740000000001, 'Drift'), (15.89740000000001, 'Quadrupole'), (15.89740000000001, 'Hcor'), (15.89740000000001, 'Vcor'), (16.09940000000001, 'Drift'), (16.09940000000001, 'CouplerKick'), (16.44540000000001, 'Cavity'), (16.44540000000001, 'CouplerKick'), (16.70740000000001, 'Drift'), (16.70740000000001, 'CouplerKick'), (17.05340000000001, 'Cavity'), (17.05340000000001, 'CouplerKick'), (17.31540000000001, 'Drift'), (17.31540000000001, 'CouplerKick'), (17.66140000000001, 'Cavity'), (17.66140000000001, 'CouplerKick'), (17.92340000000001, 'Drift'), (17.92340000000001, 'CouplerKick'), (18.26940000000001, 'Cavity'), (18.26940000000001, 'CouplerKick'), (18.531400000000012, 'Drift'), (18.531400000000012, 'CouplerKick'), (18.877400000000012, 'Cavity'), (18.877400000000012, 'CouplerKick'), (19.139400000000013, 'Drift'), (19.139400000000013, 'CouplerKick'), (19.485400000000013, 'Cavity'), (19.485400000000013, 'CouplerKick'), (19.747400000000013, 'Drift'), (19.747400000000013, 'CouplerKick'), (20.093400000000013, 'Cavity'), (20.093400000000013, 'CouplerKick'), (20.355400000000014, 'Drift'), (20.355400000000014, 'CouplerKick'), (20.701400000000014, 'Cavity'), (20.701400000000014, 'CouplerKick'), (20.856400000000015, 'Drift'), (20.856400000000015, 'Marker'), (21.896400000000014, 'Drift'), (21.896400000000014, 'Marker'), (23.192800000000013, 'Drift'), (23.192800000000013, 'Monitor'), (23.544700000000013, 'Drift'), (23.744700000000012, 'Quadrupole'), (23.849700000000013, 'Drift'), (23.849700000000013, 'Monitor'), (24.067200000000014, 'Drift'), (24.067200000000014, 'Monitor'), (24.163200000000014, 'Drift'), (24.163200000000014, 'Marker'), (24.280900000000013, 'Drift'), (24.280900000000013, 'Monitor'), (24.423200000000012, 'Drift'), (24.62320000000001, 'Quadrupole'), (24.723200000000013, 'Drift'), (24.723200000000013, 'Marker'), (24.774199858200014, 'Drift'), (24.774199858200014, 'Edge'), (24.974530141731012, 'SBend'), (24.974530141731012, 'Edge'), (25.075026858231013, 'Drift'), (25.075026858231013, 'Edge'), (25.27535714176201, 'SBend'), (25.27535714176201, 'Edge'), (25.36760699996201, 'Drift'), (25.36760699996201, 'Marker'), (25.46360699996201, 'Drift'), (25.46360699996201, 'Monitor'), (25.73535699996201, 'Drift'), (25.73535699996201, 'Monitor'), (25.92935699996201, 'Drift'), (25.92935699996201, 'Marker'), (26.66935699996201, 'Undulator'), (26.66935699996201, 'Marker'), (26.863356999962008, 'Drift'), (26.863356999962008, 'Monitor'), (26.983356858162008, 'Drift'), (26.983356858162008, 'Edge'), (27.183687141693007, 'SBend'), (27.183687141693007, 'Edge'), (27.284184858193008, 'Drift'), (27.284184858193008, 'Edge'), (27.484515141724007, 'SBend'), (27.484515141724007, 'Edge'), (27.535514999924008, 'Drift'), (27.535514999924008, 'Marker'), (27.63551499992401, 'Drift'), (27.83551499992401, 'Quadrupole'), (28.04400499992401, 'Drift'), (28.04400499992401, 'Monitor'), (28.24400499992401, 'Drift'), (28.34400499992401, 'Vcor'), (28.64700499992401, 'Drift'), (28.747004999924012, 'Hcor'), (28.944504999924014, 'Drift'), (28.944504999924014, 'Monitor'), (29.040504999924014, 'Drift'), (29.040504999924014, 'Marker'), (29.147004999924015, 'Drift'), (29.347004999924014, 'Quadrupole'), (29.417004999924014, 'Drift'), (29.417004999924014, 'CouplerKick'), (30.117004999924013, 'Cavity'), (30.117004999924013, 'CouplerKick'), (30.187004999924014, 'Drift'), (30.387004999924013, 'Quadrupole'), (31.139004999924012, 'Drift'), (31.33900499992401, 'Quadrupole'), (32.07900499992401, 'Drift'), (32.07900499992401, 'Marker'), (32.114004999924006, 'Drift'), (32.114004999924006, 'Monitor'), (32.289004999924, 'Drift'), (32.389004999924005, 'Vcor'), (32.539004999924, 'Drift'), (32.539004999924, 'Monitor'), (32.689004999924, 'Drift'), (32.889004999924005, 'Quadrupole'), (33.664004999924, 'Drift'), (33.664004999924, 'Monitor'), (33.839004999924, 'Drift'), (33.939004999924, 'Hcor'), (34.089004999924, 'Drift'), (34.089004999924, 'Monitor'), (34.239004999924, 'Drift'), (34.439004999924, 'Quadrupole'), (35.214004999924, 'Drift'), (35.214004999924, 'Monitor'), (35.489004999924, 'Drift'), (35.589004999924, 'Vcor'), (35.789004999924, 'Drift'), (35.989004999924006, 'Quadrupole'), (36.209004999924005, 'Drift'), (36.209004999924005, 'Monitor'), (36.58900499992401, 'Drift'), (36.58900499992401, 'Monitor'), (36.889004999924005, 'Drift'), (37.08900499992401, 'Quadrupole'), (37.37070499992401, 'Drift'), (37.37070499992401, 'Monitor'), (37.73500499992401, 'Drift'), (37.73500499992401, 'Monitor'), (37.88500499992401, 'Drift'), (37.88500499992401, 'Monitor'), (38.139004999924005, 'Drift'), (38.33900499992401, 'Quadrupole'), (38.889004999924005, 'Drift'), (38.889004999924005, 'Marker'), (40.12900499992401, 'Drift'), (40.22900499992401, 'Vcor'), (40.32900499992401, 'Drift'), (40.52900499992401, 'Quadrupole'), (40.67900499992401, 'Drift'), (40.67900499992401, 'Monitor'), (42.129004999924014, 'Drift'), (42.229004999924015, 'Hcor'), (42.879004999924014, 'Drift'), (43.07900499992402, 'Quadrupole'), (45.979004999924015, 'Drift'), (46.17900499992402, 'Quadrupole'), (47.979004999924015, 'Drift'), (48.17900499992402, 'Quadrupole'), (48.87900499992402, 'Drift'), (48.87900499992402, 'Monitor'), (49.079004999924024, 'Drift'), (49.27900499992403, 'Quadrupole'), (49.47900499992403, 'Drift'), (49.57900499992403, 'Vcor'), (49.779004999924034, 'Drift'), (49.879004999924035, 'Hcor'), (49.97900499992404, 'Drift'), (49.97900499992404, 'Marker'), (50.17900499992404, 'Quadrupole'), (50.38023166802404, 'Drift'), (50.38023166802404, 'Edge'), (50.58033433187704, 'SBend'), (50.58033433187704, 'Edge'), (50.58033433187704, 'Vcor'), (50.71533399997704, 'Drift'), (50.81533399997704, 'Hcor'), (51.060815999977045, 'Drift'), (51.160815999977046, 'Sextupole'), (51.26081599997705, 'Drift'), (51.46081599997705, 'Quadrupole'), (51.56081599997705, 'Drift'), (51.66081599997705, 'Sextupole'), (51.80179841947705, 'Drift'),
                    (51.80179841947705, 'Edge'), (52.00181358055005, 'SBend'), (52.00181358055005, 'Edge'), (52.16042200005005, 'Drift'), (52.16042200005005, 'Monitor'), (52.29292200005005, 'Drift'), (52.39292200005005, 'Vcor'), (52.51042200005005, 'Drift'), (52.71042200005005, 'Quadrupole'), (52.84542200005005, 'Drift'), (52.94542200005005, 'Hcor'), (53.219029419550054, 'Drift'), (53.219029419550054, 'Edge'), (53.41904458062305, 'SBend'), (53.41904458062305, 'Edge'), (53.56002700012305, 'Drift'), (53.66002700012305, 'Sextupole'), (53.76002700012305, 'Drift'), (53.960027000123056, 'Quadrupole'), (54.06002700012306, 'Drift'), (54.16002700012306, 'Sextupole'), (54.49050900012306, 'Drift'), (54.49050900012306, 'Monitor'), (54.64050866822306, 'Drift'), (54.64050866822306, 'Edge'), (54.840611332076065, 'SBend'), (54.840611332076065, 'Edge'), (55.041838000176064, 'Drift'), (55.24183800017607, 'Quadrupole'), (55.44306566827607, 'Drift'), (55.44306566827607, 'Edge'), (55.64316833212907, 'SBend'), (55.64316833212907, 'Edge'), (55.64316833212907, 'Vcor'), (55.77816800022907, 'Drift'), (55.878168000229074, 'Hcor'), (56.12365000022908, 'Drift'), (56.22365000022908, 'Sextupole'), (56.32365000022908, 'Drift'), (56.52365000022908, 'Quadrupole'), (56.623650000229084, 'Drift'), (56.723650000229085, 'Sextupole'), (56.864631419729086, 'Drift'), (56.864631419729086, 'Edge'), (57.06464658080208, 'SBend'), (57.06464658080208, 'Edge'), (57.22325500030208, 'Drift'), (57.22325500030208, 'Monitor'), (57.35575500030208, 'Drift'), (57.455755000302084, 'Vcor'), (57.57325500030208, 'Drift'), (57.773255000302086, 'Quadrupole'), (57.908255000302084, 'Drift'), (58.008255000302086, 'Hcor'), (58.281863419802086, 'Drift'), (58.281863419802086, 'Edge'), (58.48187858087508, 'SBend'), (58.48187858087508, 'Edge'), (58.62286100037508, 'Drift'), (58.72286100037508, 'Sextupole'), (58.822861000375084, 'Drift'), (59.02286100037509, 'Quadrupole'), (59.12286100037509, 'Drift'), (59.22286100037509, 'Sextupole'), (59.55334200037509, 'Drift'), (59.55334200037509, 'Monitor'), (59.70334266847509, 'Drift'), (59.70334266847509, 'Edge'), (59.90344533232809, 'SBend'), (59.90344533232809, 'Edge'), (60.10467200042809, 'Drift'), (60.30467200042809, 'Quadrupole'), (60.50589866852809, 'Drift'), (60.50589866852809, 'Edge'), (60.70600133238109, 'SBend'), (60.70600133238109, 'Edge'), (60.70600200048109, 'Drift'), (60.70600200048109, 'Vcor'), (60.84100200048109, 'Drift'), (60.94100200048109, 'Hcor'), (61.18648300048109, 'Drift'), (61.28648300048109, 'Sextupole'), (61.38648300048109, 'Drift'), (61.586483000481095, 'Quadrupole'), (61.6864830004811, 'Drift'), (61.7864830004811, 'Sextupole'), (61.9274654199811, 'Drift'), (61.9274654199811, 'Edge'), (62.127480581054094, 'SBend'), (62.127480581054094, 'Edge'), (62.28608900055409, 'Drift'), (62.28608900055409, 'Monitor'), (62.41858900055409, 'Drift'), (62.518589000554094, 'Vcor'), (62.636089000554094, 'Drift'), (62.8360890005541, 'Quadrupole'), (62.971089000554095, 'Drift'), (63.071089000554096, 'Hcor'), (63.344697420054096, 'Drift'), (63.344697420054096, 'Edge'), (63.544712581127094, 'SBend'), (63.544712581127094, 'Edge'), (63.685694000627095, 'Drift'), (63.785694000627096, 'Sextupole'), (63.8856940006271, 'Drift'), (64.0856940006271, 'Quadrupole'), (64.1856940006271, 'Drift'), (64.28569400062709, 'Sextupole'), (64.61617600062709, 'Drift'), (64.61617600062709, 'Monitor'), (64.7661766687271, 'Drift'), (64.7661766687271, 'Edge'), (64.9662793325801, 'SBend'), (64.9662793325801, 'Edge'), (65.1675060006801, 'Drift'), (65.36750600068011, 'Quadrupole'), (65.56873266878011, 'Drift'), (65.56873266878011, 'Edge'), (65.76883533263312, 'SBend'), (65.76883533263312, 'Edge'), (65.76883533263312, 'Vcor'), (65.90383500073311, 'Drift'), (66.0038350007331, 'Hcor'), (66.2493170007331, 'Drift'), (66.3493170007331, 'Sextupole'), (66.44931700073309, 'Drift'), (66.64931700073309, 'Quadrupole'), (66.74931700073309, 'Drift'), (66.84931700073308, 'Sextupole'), (66.99029842023307, 'Drift'), (66.99029842023307, 'Edge'), (67.19031358130607, 'SBend'), (67.19031358130607, 'Edge'), (67.19031400080607, 'Drift'), (67.19031400080607, 'Vcor'), (67.34892200080607, 'Drift'), (67.34892200080607, 'Monitor'), (67.48142200080606, 'Drift'), (67.58142200080606, 'Hcor'), (67.69892200080606, 'Drift'), (67.89892200080607, 'Quadrupole'), (68.40753042030607, 'Drift'), (68.40753042030607, 'Edge'), (68.60754558137907, 'SBend'), (68.60754558137907, 'Edge'), (68.74852800087908, 'Drift'), (68.84852800087907, 'Sextupole'), (68.94852800087907, 'Drift'), (69.14852800087907, 'Quadrupole'), (69.24852800087906, 'Drift'), (69.34852800087906, 'Sextupole'), (69.44651000087906, 'Drift'), (69.54651000087905, 'Vcor'), (69.67901000087905, 'Drift'), (69.67901000087905, 'Monitor'), (69.82900966897904, 'Drift'), (69.82900966897904, 'Edge'), (70.02911233283204, 'SBend'), (70.02911233283204, 'Edge'), (70.23033900093205, 'Drift'), (70.43033900093205, 'Quadrupole'), (70.43033900093205, 'Marker'), (71.33046900093206, 'Drift'), (71.33046900093206, 'Monitor'), (71.53046900093206, 'Drift'), (71.63046900093205, 'Vcor'), (71.74046900093205, 'Drift'), (71.94046900093205, 'Quadrupole'), (72.24046900093205, 'Drift'), (72.24046900093205, 'Monitor'), (72.33646900093206, 'Drift'), (72.33646900093206, 'Marker'), (72.54046900093205, 'Drift'), (72.64046900093204, 'Hcor'), (72.75046900093204, 'Drift'), (72.95046900093205, 'Quadrupole'), (73.35046900093205, 'Drift'), (73.35046900093205, 'Marker'), (73.45046944043204, 'Drift'), (73.45046944043204, 'Edge'), (73.95194056135904, 'SBend'), (73.95194056135904, 'Edge'), (74.96081344045903, 'Drift'), (74.96081344045903, 'Edge'), (75.46228456138603, 'SBend'), (75.46228456138603, 'Edge'), (75.46228500088603, 'Drift'), (75.46228500088603, 'Vcor'), (76.32728500088602, 'Drift'), (76.32728500088602, 'Monitor'), (76.63728500088602, 'Drift'), (76.63728500088602, 'Monitor'), (76.96228544038603, 'Drift'), (76.96228544038603, 'Edge'), (77.46375656131302, 'SBend'), (77.46375656131302, 'Edge'), (77.46375656131302, 'Vcor'), (78.47262944041302, 'Drift'), (78.47262944041302, 'Edge'), (78.97410056134001, 'SBend'), (78.97410056134001, 'Edge'), (78.97410100084001, 'Drift'), (78.97410100084001, 'Vcor'), (79.07410100084, 'Drift'), (79.07410100084, 'Marker'), (79.48410100084, 'Drift'), (79.68410100084, 'Quadrupole'), (79.79410100084, 'Drift'), (79.89410100084, 'Hcor'), (80.14410100084, 'Drift'), (80.14410100084, 'Monitor'), (80.24010100084, 'Drift'), (80.24010100084, 'Marker'), (80.38410100084, 'Drift'), (80.48410100084, 'Vcor'), (80.59410100084, 'Drift'), (80.79410100084, 'Quadrupole'), (80.99410100084, 'Drift'), (80.99410100084, 'Monitor'), (81.55410100084, 'Drift'), (81.65410100084, 'Hcor'), (81.76410100084, 'Drift'), (81.96410100084, 'Quadrupole'), (81.96410100084, 'Marker'), (82.16410100084, 'Drift'), (82.16410100084, 'Monitor'), (84.05410100084, 'Drift'), (84.15410100084, 'Vcor'), (84.26410100084, 'Drift'), (84.46410100084, 'Quadrupole'), (84.66410100084, 'Drift'), (84.66410100084, 'Monitor'), (86.55410100084, 'Drift'), (86.65410100084, 'Hcor'), (86.76410100084, 'Drift'), (86.96410100084, 'Quadrupole'), (87.16410100084, 'Drift'), (87.16410100084, 'Monitor'), (89.05410100084, 'Drift'), (89.15410100084, 'Vcor'), (89.26410100084, 'Drift'), (89.46410100084, 'Quadrupole'), (89.66410100084, 'Drift'), (89.66410100084, 'Monitor'), (91.70410100084001, 'Drift'), (91.80410100084, 'Hcor'), (91.91410100084, 'Drift'), (92.11410100084001, 'Quadrupole'), (92.31410100084001, 'Drift'), (92.31410100084001, 'Monitor'), (93.43830100084001, 'Drift'), (93.43830100084001, 'Monitor'), (93.57910100084001, 'Drift'), (93.67910100084, 'Vcor'), (93.78910100084, 'Drift'), (93.98910100084001, 'Quadrupole'), (94.14760100084001, 'Drift'), (94.14760100084001, 'Monitor'), (95.23892100084001, 'Drift'), (95.23892100084001, 'Monitor'), (95.58795100084001, 'Drift'), (95.58795100084001, 'Monitor'), (95.67910100084, 'Drift'), (95.77910100084, 'Hcor'), (95.88910100084, 'Drift'), (96.08910100084, 'Quadrupole'), (96.25190100084001, 'Drift'), (96.25190100084001, 'Monitor'), (96.60410100084, 'Drift'), (96.60410100084, 'Marker')]

    print(f"Is CouplerKick in {'CouplerKick' in [truth[1] for truth in ground_truth[:39]] or 'Edge' in [truth[1] for truth in ground_truth[:39]]}")

    i = 0
    for truth, s in zip(ground_truth, [tw.s for tw in tws]):
        if s != truth[0]:
            print(f"index {i}: new: {s} old {truth[0]} name {truth[1]}")
        i += 1


def test_e_delta(tws):
    ground_truth = [(0, 'none'), (0.0, 'Marker'), (0.0, 'Marker'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Solenoid'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.01815975, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Quadrupole'), (0.0, 'Hcor'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Hcor'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (-0.0024999884, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Undulator'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'CouplerKick'), (0.0, 'Cavity'), (0.0, 'CouplerKick'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'),
                    (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Sextupole'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Edge'), (0.0, 'SBend'), (0.0, 'Edge'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Marker'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Vcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Hcor'), (0.0, 'Drift'), (0.0, 'Quadrupole'), (0.0, 'Drift'), (0.0, 'Monitor'), (0.0, 'Drift'), (0.0, 'Marker')]
    i = 0
    for truth, tw in zip(ground_truth, tws):
        if tw != truth[0]:
            print(f"index {i}: new delta_e: {tw} old delta_e {truth[0]} name {truth[1]}")
        i += 1


def test_twiss_beta(tws):
    ground_truth = [(29.171, 29.171, 'none'), (29.171, 29.171, 'Marker'), (29.171, 29.171, 'Marker'), (29.171, 29.171, 'Marker'),
                    (23.439846033951525, 23.439846033951525, 'Drift'), (23.439846033951525, 23.439846033951525, 'Solenoid'), (15.071956654297075, 15.071956654297075, 'Drift'),
                    (14.6823631608661, 14.6823631608661, 'Hcor'), (14.297955126666896, 14.297955126666896, 'Vcor'), (10.73907504242227, 10.73907504242227, 'Drift'),
                    (10.73907504242227, 10.73907504242227, 'Monitor'), (8.852649035000516, 8.852649035000516, 'Drift'), (8.852649035000516, 8.852649035000516, 'Monitor'),
                    (8.852649035000516, 8.852649035000516, 'Monitor'), (6.640345017488719, 6.640345017488719, 'Drift'), (6.640345017488719, 6.640345017488719, 'Marker'),
                    (6.640345017488719, 6.640345017488719, 'Marker'), (3.697478638977067, 3.697478638977067, 'Drift'), (3.5107403106929835, 3.5107403106929835, 'Hcor'),
                    (3.3291874416406717, 3.3291874416406717, 'Vcor'), (2.914617229580749, 2.914617229580749, 'Drift'), (2.914617229580749, 2.914617229580749, 'Monitor'),
                    (1.6259929929459058, 1.6259929929459058, 'Drift'), (1.6259929929459058, 1.6259929929459058, 'Monitor'), (1.6259929929459058, 1.6259929929459058, 'Monitor'),
                    (1.2362603672148715, 1.2362603672148715, 'Drift'), (1.2362603672148715, 1.2362603672148715, 'Monitor'), (0.8362990923897026, 0.8362990923897026, 'Drift'),
                    (0.8362990923897026, 0.8362990923897026, 'Monitor'), (0.6895307134345758, 0.6895307134345758, 'Drift'), (0.6239247128046694, 0.6239247128046694, 'Hcor'),
                    (0.5635041714065343, 0.5635041714065343, 'Vcor'), (0.28908933904507883, 0.28908933904507883, 'Drift'), (0.28908933904507883, 0.28908933904507883, 'Marker'),
                    (1.538282026670322, 1.538282026670322, 'Drift'), (1.538282026670322, 1.538282026670322, 'Marker'), (2.0415338010326685, 2.0415338010326685, 'Drift'),
                    (2.0415338010326685, 2.0415338010326685, 'Marker'), (3.456490633592128, 3.456490633592128, 'Drift'), (3.456490633592128, 3.456490633592128, 'CouplerKick')]
    i = 0
    for truth, beta in zip(ground_truth, [(tw.beta_x, tw.beta_y) for tw in tws[:40]]):
        if truth[0] != beta[0]:
            print(f"index {i}: new beta_x: {beta[0]} old beta_x {truth[0]} name {truth[2]}")
        if truth[1] != beta[1]:
            print(f"index {i}: new beta_y: {beta[1]} old beta_y {truth[1]} name {truth[2]}")
        i += 1


lat = MagneticLattice(cell, stop=None)


# initialization of Twiss object
tws0 = Twiss()
# defining initial twiss parameters
tws0.beta_x = 29.171
tws0.beta_y = 29.171
tws0.alpha_x = 10.955
tws0.alpha_y = 10.955
# defining initial electron energy in GeV
tws0.E = 0.005

# calculate optical functions with initial twiss parameters
tws = twiss(lat, tws0, nPoints=None)

dx = [twiss.Dx for twiss in tws]
dy = [twiss.Dy for twiss in tws]
plt.plot(dx)
plt.plot(dy)
plt.show()
# ploting twiss paramenters.
plot_opt_func(lat, tws, top_plot=["Dx", "Dy"], fig_name="i1", legend=False)
plt.show()


Rs_old = np.load('R_list.npy', allow_pickle=True)

Rs_new = [twiss.R for twiss in tws[1:]]

i = 0
indices = []
for twiss_new, R_old in zip([twiss for twiss in tws[1:]], Rs_old):
    if not np.allclose(twiss_new.R, R_old, rtol=1e-05, atol=1e-08, equal_nan=False):
        print(f"Matrices at index {i} are not the same. E new {twiss_new.E}")
        indices.append(i)
    i += 1
print(indices)

# ground_truth = [0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.02315975, 0.02315975, 0.02315975, 0.02315975, 0.041319499999999995, 0.041319499999999995, 0.041319499999999995, 0.041319499999999995, 0.05947925, 0.05947925, 0.05947925, 0.05947925, 0.077639, 0.077639, 0.077639, 0.077639, 0.09579875, 0.09579875, 0.09579875, 0.09579875, 0.1139585, 0.1139585, 0.1139585, 0.1139585, 0.13211825, 0.13211825, 0.13211825, 0.13211825, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.150278, 0.14777801159999998, 0.14777801159999998, 0.14777801159999998, 0.14777801159999998, 0.1452780232, 0.1452780232, 0.1452780232, 0.1452780232, 0.1427780348, 0.1427780348, 0.1427780348, 0.1427780348, 0.14027804640000002, 0.14027804640000002, 0.14027804640000002, 0.14027804640000002, 0.13777805800000004, 0.13777805800000004, 0.13777805800000004, 0.13777805800000004, 0.13527806960000005, 0.13527806960000005, 0.13527806960000005, 0.13527806960000005, 0.13277808120000006, 0.13277808120000006, 0.13277808120000006, 0.13277808120000006, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008, 0.13027809280000008]

# i = 0
# for truth_value, value in zip(ground_truth, [twiss.E for twiss in tws]):
#     if truth_value != value:
#         print(f"index {i} old {truth_value} new {value}")
#     i += 1

print(len(tws))
